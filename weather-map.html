<!-- weather-map.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeatherNow - Weather Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }

        nav {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 900;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: opacity 0.3s;
        }

        .nav-links a:hover {
            opacity: 0.7;
        }

        .nav-links a.active {
            border-bottom: 2px solid white;
        }

        .map-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 2rem;
        }

        .page-title {
            text-align: center;
            font-size: 3rem;
            margin-bottom: 2rem;
        }

        .map-controls {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .control-btn:hover,
        .control-btn.active {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        .map-display {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1rem;
            border-radius: 20px;
        }

        #map {
            width: 100%;
            height: 600px;
            border-radius: 15px;
        }

        .leaflet-popup-content-wrapper {
            background: rgba(0, 0, 0, 0.9);
            color: white;
        }

        .leaflet-popup-tip {
            background: rgba(0, 0, 0, 0.9);
        }

        .popup-content {
            padding: 0.5rem;
        }

        .popup-temp {
            font-size: 2rem;
            font-weight: 900;
            margin: 0.5rem 0;
        }

        .popup-description {
            text-transform: capitalize;
            margin-bottom: 0.5rem;
        }

        .legend {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 15px;
            margin-top: 2rem;
        }

        .legend-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .legend-items {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        @media (max-width: 768px) {
            .page-title {
                font-size: 2rem;
            }

            #map {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <nav>
        <div class="logo">üå§Ô∏è WeatherNow</div>
        <ul class="nav-links">
            <li><a href="indedx.html.html">Home</a></li>
            <li><a href="weather-current.html">Current</a></li>
            <li><a href="weather-forecast.html">Forecast</a></li>
            <li><a href="weather-map.html" class="active">Map</a></li>
        </ul>
    </nav>

    <div class="map-container">
        <h1 class="page-title">Interactive Weather Map</h1>

        <div class="map-controls">
            <button class="control-btn active" onclick="setLayer('temp')">Temperature</button>
            <button class="control-btn" onclick="setLayer('clouds')">Clouds</button>
            <button class="control-btn" onclick="setLayer('precipitation')">Precipitation</button>
            <button class="control-btn" onclick="setLayer('wind')">Wind Speed</button>
        </div>

        <div class="map-display">
            <div id="map"></div>
        </div>

        <div class="legend">
            <div class="legend-title">Weather Layers</div>
            <div class="legend-items">
                <div class="legend-item">
                    <span>üå°Ô∏è</span>
                    <span>Temperature overlay</span>
                </div>
                <div class="legend-item">
                    <span>‚òÅÔ∏è</span>
                    <span>Cloud coverage</span>
                </div>
                <div class="legend-item">
                    <span>üåßÔ∏è</span>
                    <span>Precipitation levels</span>
                </div>
                <div class="legend-item">
                    <span>üí®</span>
                    <span>Wind speed patterns</span>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const API_KEY = '8ac5c4d57ba6a4b3dfcf622700447b1e';
        let map;
        let weatherLayer;
        let currentLayer = 'temp';

        const weatherIcons = {
            '01d': '‚òÄÔ∏è', '01n': 'üåô',
            '02d': '‚õÖ', '02n': '‚òÅÔ∏è',
            '03d': '‚òÅÔ∏è', '03n': '‚òÅÔ∏è',
            '04d': '‚òÅÔ∏è', '04n': '‚òÅÔ∏è',
            '09d': 'üåßÔ∏è', '09n': 'üåßÔ∏è',
            '10d': 'üå¶Ô∏è', '10n': 'üåßÔ∏è',
            '11d': '‚õàÔ∏è', '11n': '‚õàÔ∏è',
            '13d': '‚ùÑÔ∏è', '13n': '‚ùÑÔ∏è',
            '50d': 'üå´Ô∏è', '50n': 'üå´Ô∏è'
        };

        function initMap() {
            const lat = parseFloat(localStorage.getItem('weatherLat')) || 51.5074;
            const lon = parseFloat(localStorage.getItem('weatherLon')) || -0.1278;

            map = L.map('map').setView([lat, lon], 6);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);

            updateWeatherLayer();
            addCityMarkers();
        }

        function updateWeatherLayer() {
            if (weatherLayer) {
                map.removeLayer(weatherLayer);
            }

            const layers = {
                'temp': 'temp_new',
                'clouds': 'clouds_new',
                'precipitation': 'precipitation_new',
                'wind': 'wind_new'
            };

            weatherLayer = L.tileLayer(
                'https://tile.openweathermap.org/map/' + layers[currentLayer] + '/{z}/{x}/{y}.png?appid=' + API_KEY,
                {
                    attribution: 'Weather from OpenWeatherMap',
                    opacity: 0.6
                }
            ).addTo(map);
        }

        async function addCityMarkers() {
            const majorCities = [
                { name: 'London', lat: 51.5074, lon: -0.1278 },
                { name: 'Paris', lat: 48.8566, lon: 2.3522 },
                { name: 'Berlin', lat: 52.5200, lon: 13.4050 },
                { name: 'Madrid', lat: 40.4168, lon: -3.7038 },
                { name: 'Rome', lat: 41.9028, lon: 12.4964 },
                { name: 'Amsterdam', lat: 52.3676, lon: 4.9041 }
            ];

            for (const city of majorCities) {
                try {
                    const response = await fetch(
                        'https://api.openweathermap.org/data/2.5/weather?lat=' + city.lat + '&lon=' + city.lon + '&appid=' + API_KEY + '&units=metric'
                    );
                    const data = await response.json();

                    const iconEmoji = weatherIcons[data.weather[0].icon] || 'üå§Ô∏è';

                    const icon = L.divIcon({
                        html: '<div style="font-size: 2rem;">' + iconEmoji + '</div>',
                        className: 'weather-marker',
                        iconSize: [40, 40]
                    });

                    const marker = L.marker([city.lat, city.lon], { icon: icon }).addTo(map);

                    const popupHTML = '<div class="popup-content">' +
                        '<strong>' + data.name + '</strong>' +
                        '<div class="popup-temp">' + Math.round(data.main.temp) + '¬∞C</div>' +
                        '<div class="popup-description">' + data.weather[0].description + '</div>' +
                        '<div>üíß ' + data.main.humidity + '% | üí® ' + data.wind.speed + ' m/s</div>' +
                        '</div>';

                    marker.bindPopup(popupHTML);
                } catch (error) {
                    console.error('Error fetching weather for ' + city.name);
                }
            }
        }

        function setLayer(layer) {
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            currentLayer = layer;
            updateWeatherLayer();
        }

        window.addEventListener('load', initMap);
    </script>
</body>
</html>